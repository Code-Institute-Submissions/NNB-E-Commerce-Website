{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}{{ product.name }} | NNB {{ product.category|title }}{% endblock %}

{% block extra_css %}
    <!-- Custom Products Page CSS -->
    <link rel="stylesheet" href="{% static 'products/css/product.css' %}">
{% endblock %}

{% block content %}

<div class="container-fluid push-down">
    <!--  Breadcrumbs -->
    <div class="row">
        <div class="col-12 col-md-10 product-top-sect">
            <div>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'display_products' %}?product_type={{ product.category }}">Products - {{ product.category|title }}</a></li>
                    <li class="breadcrumb-item active" aria-current="page">{{ product.name }}</li>
                </ol>
            </div>
        </div>
    </div>
    <!--  / .Breadcrumbs -->


    <div class="all-products row">
        <!-- Product Images -->
        <div class="col-sm-12 col-md-6">
            <div id="images">
                <div class="image-container">
                    <img id="expandedImg" src="{{ product.image_1.url }}">
                </div>

                <div class="image-row">
                    <div class="column" id="first-image">
                        <img class="small-image" src="{{ product.image_1.url }}" alt="{{ product.name }} Image 1" onclick="myFunction(this);">
                    </div>
                    <div class="column">
                        <img class="small-image" src="{{ product.image_2.url }}" alt="{{ product.name }} Image 2" onclick="myFunction(this);">
                    </div>
                    <div class="column">
                        <img class="small-image" src="{{ product.image_3.url }}" alt="{{ product.name }} Image 3" onclick="myFunction(this);">
                    </div>
                    <div class="column">
                        <img class="small-image" src="{{ product.image_4.url }}" alt="{{ product.name }} Image 4" onclick="myFunction(this);">
                    </div>
                    <div class="column">
                        <img class="small-image" src="{{ product.image_5.url }}" alt="{{ product.name }} Image 5" onclick="myFunction(this);">
                    </div>
                </div>
            </div>
        </div>
        <!-- / .Product Images -->

        <!-- Product Information -->
        <div class="col-6">
            <h1 style="text-align: center;">Product</h1>
        </div>
        <!-- / .Product Information -->
    </div>
</div>

    <p>This is the product template</p>

    <h1>{{ product.name }}</h1>
    <p><strong>Rating:</strong> {{ review_average }} ({{ reviews_amounts }})</p>
    <p><strong>Product Name:</strong> {{ product.name }}</p>
    <p><strong>Product Category:</strong> {{ product.category }}</p>
    <p><strong>Product Code:</strong> {{ product.product_code }}</p>
    <p><strong>Product Description:</strong> {{ product.product_description|linebreaksbr  }}</p>
    <p><strong>Original Product Price:</strong> <s>&euro;{{ product.price_original }}</s></p>
    <p><strong>Current Product Price:</strong> &euro;{{ product.price_current }}</p>
    {% if product.in_stock %}
        {% if product.stock >= 10%}
            <p><strong>In Stock ? :</strong> In Stock</p>
        {% else %}
            <p><strong>In Stock ? :</strong> Low Stock</p>
        {% endif %}
    {% else %}
        <p><strong>In Stock ? :</strong> Out of Stock</p>
    {% endif %}
    <p><strong>Stock Amount:</strong> {{ product.stock }}</p>

    <p><strong>Image 1:</strong></p>
    <img src="{{ product.image_1.url }}" alt="" height="100" width="100">
    {% if product.image_2 %}
        <p><strong>Image 2:</strong></p>
        <img src="{{ product.image_2.url }}" alt="" height="100" width="100">
    {% endif %}
    {% if product.image_3 %}
        <p><strong>Image 3:</strong></p>
        <img src="{{ product.image_3.url }}" alt="" height="100" width="100">
    {% endif %}
    {% if product.image_4 %}
        <p><strong>Image 4:</strong></p>
        <img src="{{ product.image_4.url }}" alt="" height="100" width="100">
    {% endif %}
    {% if product.image_5 %}
        <p><strong>Image 5:</strong></p>
        <img src="{{ product.image_5.url }}" alt="" height="100" width="100">
    {% endif %}

    {% if product.in_stock %}
        <form action="{% url 'add_to_cart' product.id %}" method="POST">
            {% csrf_token %}
            <input class="form-control qty_input" type="number" value="1" min="1" max="{{ product.stock }}" name="quantity" data-item_id="{{ product.id }}" id="id_qty_{{ product.id }}">
            <input type="submit" value="Add to Cart">
            <input type="hidden" name="redirect_url" value="{{ request.path }}">
        </form>
    {% else %}
        <button type="button" class="btn btn-primary" disabled>Out of Stock</button>
    {% endif %}

    <h2>Add Review</h2>
    <form action="{% url 'add_review' product.id %}" method="POST">
        {% csrf_token %}

        <input type="text" placeholder="Display Name" name="display_name">
        <input type="number" min="1" max="5" placeholder="Rating" name="rating">
        <input type="text" placeholder="Review Title" name="title">

        <textarea name="product_review" id="" cols="30" rows="5"></textarea>

        <input type="submit" value="Post Review">
    </form>   

    <ul>
        {% for review in reviews %}
            {% if review.display_name %}
                <li>By: {{ review.display_name }}</li>
            {% else %}
                <li>{{ review.user }}</li>
            {% endif %}
            <li>Rating: {{ review.rating }}</li>
            <li>Title: {{ review.title }}</li>
            <li>Review: {{ review.product_review }}</li>
            {% if request.user == review.user %}
                <a href="{% url 'edit_review' product.id review.id %}">Edit Review</a>
                <a href="{% url 'delete_review' product.id review.id %}" onclick="return confirm('Are you sure you would like to delete this review ?');">Delete Review</a>
            {% endif %}
            <br>
        {% endfor %}
    </ul>

    <script>
        function myFunction(imgs) {
        var expandImg = document.getElementById("expandedImg");
        expandImg.src = imgs.src;
        }
    </script>
{% endblock %}